- name: miniconda installer
  get_url:
    url: https://repo.anaconda.com/miniconda/{{miniconda_installer_filename}}
    dest: "{{miniconda_installer_path}}"

- name: miniconda
  shell: "bash {{miniconda_installer_path}} -b -p {{miniconda_path}}"
  args:
    creates:  "{{miniconda_path}}/bin/conda"

- name: conda envs dir
  file:
    path: "{{conda_envs_dir}}"
    state: directory

- name: condarun script
  copy:
    dest: "{{conda_envs_dir}}/condarun"
    mode: "u=rwx,g=rx,o=rx"
    content: |
      #!/bin/bash
      set -e

      env=$1
      shift

      . /etc/profile.d/conda.sh
      conda activate "$env"
      python "$@"
